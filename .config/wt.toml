[post-start]
# Seed compiled deps from main worktree using CoW (~3s vs ~68s full rebuild)
deps = """
[ -d {{ repo_root }}/target/debug/deps ] && [ ! -e target ] &&
mkdir -p target/debug/deps &&
cp -c {{ repo_root }}/target/debug/deps/*.rlib {{ repo_root }}/target/debug/deps/*.rmeta target/debug/deps/ &&
cp -cR {{ repo_root }}/target/debug/.fingerprint {{ repo_root }}/target/debug/build target/debug/
"""
assets = "./dev/fetch-assets"
docs = "cd {{ worktree }}/docs && zola serve -p {{ branch | hash_port }}"

[post-merge]
build = "cargo build --all-targets"
install = "cargo install --path ."
sync = 'if [ "{{ target }}" = "main" ]; then git pull && git push; fi'

[pre-merge]
pre-commit = "if [ -n \"$MSYSTEM\" ]; then SKIP=lychee-system pre-commit run --all-files; else pre-commit run --all-files; fi"
insta = "RUSTFLAGS='-D warnings' NEXTEST_STATUS_LEVEL=fail NEXTEST_SUCCESS_OUTPUT=never NEXTEST_NO_INPUT_HANDLER=1 cargo insta test --dnd --check --features shell-integration-tests"
doctest = "RUSTDOCFLAGS='-Dwarnings' cargo test --doc"
doc = "RUSTDOCFLAGS='-Dwarnings' cargo doc --no-deps"

[list]
url = "http://127.0.0.1:{{ branch | hash_port }}"
